#:import dp kivy.metrics.dp
#:import hex kivy.utils.get_color_from_hex
#:set PRIMARY_COLOR hex("#4a6ee0")
#:set SECONDARY_COLOR hex("#6c8ce8")
#:set ACCENT_COLOR hex("#ff5252")
#:set SUCCESS_COLOR hex("#4CAF50")
#:set LIGHT_COLOR hex("#f5f7fa")
#:set DARK_COLOR hex("#2c3e50")
#:set CARD_BG hex("#ffffff")
#:set SHADOW_COLOR hex("#00000020")

<ModernButton>:
    background_color: 0, 0, 0, 0
    background_normal: ''
    background_down: ''
    color: 1, 1, 1, 1
    font_size: '16sp'
    bold: True
    size_hint_y: None
    height: dp(50)
    canvas.before:
        Color:
            rgba: self.bg_color if self.state == 'normal' else (self.bg_color[0]*0.8, self.bg_color[1]*0.8, self.bg_color[2]*0.8, self.bg_color[3])
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(12),]
        Color:
            rgba: 1, 1, 1, 0.15
        Line:
            rounded_rectangle: [self.x, self.y, self.width, self.height, dp(12)]
            width: 1
    canvas.after:
        Color:
            rgba: 0, 0, 0, 0.1
        Line:
            rounded_rectangle: [self.x, self.y, self.width, self.height, dp(12)]
            width: 0.5

<IconButton>:
    background_color: 0, 0, 0, 0
    background_normal: ''
    color: 1, 1, 1, 1
    font_size: '20sp'
    size_hint: (None, None)
    size: [dp(50), dp(50)]
    canvas.before:
        Color:
            rgba: self.bg_color if self.state == 'normal' else (self.bg_color[0]*0.8, self.bg_color[1]*0.8, self.bg_color[2]*0.8, self.bg_color[3])
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(25),]

<ModernTextInput>:
    background_color: 0, 0, 0, 0
    foreground_color: 0.1, 0.1, 0.2, 1
    hint_text_color: 0.5, 0.5, 0.5, 1
    font_size: '16sp'
    padding: [dp(15), dp(12)]
    multiline: False
    size_hint_y: None
    height: dp(50)
    cursor_color: PRIMARY_COLOR
    cursor_width: '2sp'
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(10),]
        Color:
            rgba: PRIMARY_COLOR if self.focus else (0.8, 0.8, 0.8, 1)
        Line:
            rounded_rectangle: [self.x, self.y, self.width, self.height, dp(10)]
            width: dp(2)

<ModernTextArea>:
    background_color: 0, 0, 0, 0
    foreground_color: 0.1, 0.1, 0.2, 1
    hint_text_color: 0.5, 0.5, 0.5, 1
    font_size: '15sp'
    padding: [dp(15), dp(12)]
    multiline: True
    size_hint_y: None
    cursor_color: PRIMARY_COLOR
    cursor_width: '2sp'
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(10),]
        Color:
            rgba: PRIMARY_COLOR if self.focus else (0.8, 0.8, 0.8, 1)
        Line:
            rounded_rectangle: [self.x, self.y, self.width, self.height, dp(10)]
            width: dp(2)

<Card>:
    orientation: 'vertical'
    padding: [dp(20), dp(20)]
    spacing: dp(15)
    size_hint_y: None
    canvas.before:
        Color:
            rgba: CARD_BG
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(16),]
        Color:
            rgba: SHADOW_COLOR
        RoundedRectangle:
            pos: (self.x - dp(2), self.y - dp(2))
            size: (self.width + dp(4), self.height + dp(4))
            radius: [dp(16),]

<TitleLabel>:
    color: DARK_COLOR
    font_size: '20sp'
    bold: True
    size_hint_y: None
    height: dp(40)
    text_size: self.size
    halign: 'left'
    valign: 'middle'

<SubtitleLabel>:
    color: 0.6, 0.6, 0.6, 1
    font_size: '14sp'
    size_hint_y: None
    height: dp(30)
    text_size: self.size
    halign: 'left'
    valign: 'middle'

<BodyText>:
    color: 0.3, 0.3, 0.3, 1
    font_size: '15sp'
    size_hint_y: None
    text_size: self.size
    halign: 'left'
    valign: 'top'

<CaptionText>:
    color: 0.5, 0.5, 0.5, 1
    font_size: '12sp'
    size_hint_y: None
    text_size: self.size
    halign: 'left'
    valign: 'middle'

<ModernPopup>:
    background: ''
    separator_height: 0
    overlay_color: 0, 0, 0, 0.5
    canvas.before:
        Color:
            rgba: 0, 0, 0, 0.5
        Rectangle:
            pos: self.pos
            size: self.size

<TabButton>:
    background_color: 0, 0, 0, 0
    background_normal: ''
    color: 1, 1, 1, 1 if self.active else 0.8
    font_size: '16sp'
    bold: True
    size_hint_x: 1
    canvas.before:
        Color:
            rgba: PRIMARY_COLOR if self.active else SECONDARY_COLOR
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(10), dp(10), 0, 0]
        Color:
            rgba: 1, 1, 1, 0.2 if self.active else 0.1
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(10), dp(10), 0, 0]

<FloatingActionButton>:
    background_color: 0, 0, 0, 0
    background_normal: ''
    color: 1, 1, 1, 1
    font_size: '24sp'
    size_hint: (None, None)
    size: [dp(60), dp(60)]
    canvas.before:
        Color:
            rgba: self.bg_color
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(30),]
        Color:
            rgba: 0, 0, 0, 0.1
        RoundedRectangle:
            pos: (self.x + dp(2), self.y - dp(2))
            size: self.size
            radius: [dp(30),]

<LoadingSpinner>:
    canvas:
        Color:
            rgba: PRIMARY_COLOR
        Line:
            circle: (self.center_x, self.center_y, min(self.width, self.height) * 0.2, self.angle, 360 + self.angle)
            width: dp(3)

<Divider>:
    size_hint_y: None
    height: dp(1)
    canvas:
        Color:
            rgba: 0.9, 0.9, 0.9, 1
        Rectangle:
            pos: self.pos
            size: self.size

<LoginRegisterScreen>:
    orientation: 'vertical'
    padding: dp(30)
    spacing: dp(20)
    canvas.before:
        Color:
            rgba: LIGHT_COLOR
        Rectangle:
            pos: self.pos
            size: self.size
        Color:
            rgba: PRIMARY_COLOR
        Ellipse:
            pos: (-self.width * 0.5, self.height * 0.6)
            size: (self.width * 2, self.height * 0.8)
        Color:
            rgba: 1, 1, 1, 0.1
        Ellipse:
            pos: (-self.width * 0.3, self.height * 0.65)
            size: (self.width * 1.6, self.height * 0.7)
    
    TitleLabel:
        text: 'üì± –ú–æ–π –ë–ª–æ–≥'
        size_hint_y: None
        height: dp(60)
        color: 1, 1, 1, 1
        font_size: '28sp'
        halign: 'center'
        bold: True
    
    SubtitleLabel:
        text: '–î–µ–ª–∏—Ç–µ—Å—å –º–æ–º–µ–Ω—Ç–∞–º–∏ –∂–∏–∑–Ω–∏'
        size_hint_y: None
        height: dp(30)
        color: 1, 1, 1, 0.9
        halign: 'center'
    
    Card:
        size_hint_y: None
        height: dp(400)
        padding: [dp(20), dp(20)]
        spacing: dp(15)
        
        BoxLayout:
            orientation: 'vertical'
            spacing: dp(15)
            
            BoxLayout:
                orientation: 'horizontal'
                size_hint_y: None
                height: dp(50)
                spacing: dp(2)
                
                TabButton:
                    id: login_tab
                    text: '–í—Ö–æ–¥'
                    active: True
                    on_press: root.show_login()
                
                TabButton:
                    id: register_tab
                    text: '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è'
                    active: False
                    on_press: root.show_register()
            
            ScrollView:
                BoxLayout:
                    id: form_layout
                    orientation: 'vertical'
                    size_hint_y: None
                    height: dp(300)
                    spacing: dp(10)
